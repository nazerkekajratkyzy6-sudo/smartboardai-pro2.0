<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Class Assessment Dashboard</title>
<style>
  :root{
    --bg:#f8fafc;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#64748b;
    --line:#e2e8f0;
    --icon-off:#cbd5e1;
    --icon-on:#facc15;
    --accent:#2563eb;
    --green:#22c55e;
    --danger:#ef4444;
  }
  html,body{
    margin:0;padding:0;
    background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{max-width:1150px;margin:24px auto;padding:0 16px}
  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    box-shadow:0 4px 16px rgba(15,23,42,.06);
  }
  .header{
    display:flex;gap:10px;align-items:flex-start;justify-content:space-between;
    padding:14px 18px;border-bottom:1px solid var(--line);flex-wrap:wrap;
  }
  .title{font-size:19px;font-weight:700}
  .subtitle{font-size:13px;color:var(--muted)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:6px}
  .modes{display:flex;gap:6px;flex-wrap:wrap}
  .mode-btn{
    border:1px solid var(--line);
    background:#fff;border-radius:10px;
    padding:6px 10px;font-weight:600;cursor:pointer;
    font-size:13px;
  }
  .mode-btn[aria-pressed="true"]{
    background:var(--accent);
    border-color:var(--accent);
    color:#fff;
  }
  button{
    border:1px solid var(--line);
    background:#fff;border-radius:10px;
    padding:8px 12px;font-weight:600;cursor:pointer;
    font-size:13px;
  }
  button.primary{
    background:var(--accent);color:#fff;border-color:var(--accent);
  }
  button.danger{
    background:#fee2e2;color:#b91c1c;border-color:#fecaca;
  }

  .layout{
    display:grid;
    grid-template-columns: minmax(0,2fr) minmax(260px,1.2fr);
    gap:12px;
    padding:12px 16px 14px;
  }
  @media (max-width:900px){
    .layout{grid-template-columns:1fr}
  }

  /* TEAMS */
  .teams-card{
    border:1px solid var(--line);
    border-radius:14px;
    padding:10px 12px;
    background:#f1f5f9;
  }
  .teams-title{
    font-size:14px;font-weight:700;margin-bottom:8px;
  }
  .teams{
    display:flex;flex-direction:column;gap:8px;
  }
  .team{
    display:flex;align-items:center;gap:8px;
    padding:6px 8px;
    border-radius:10px;
    background:#fff;
    border:1px solid var(--line);
  }
  .team-name{font-weight:700;font-size:13px;min-width:70px}
  .team-score{font-weight:800;font-variant-numeric:tabular-nums}
  .team-buttons{margin-left:auto;display:flex;gap:4px;flex-wrap:wrap}
  .team-buttons button{
    padding:4px 8px;font-size:12px;
  }

  /* TABLE */
  .table-wrapper{overflow:auto;border:1px solid var(--line);border-radius:14px;}
  table{width:100%;border-collapse:separate;border-spacing:0}
  thead th{
    position:sticky;top:0;
    background:#f1f5f9;
    border-bottom:1px solid var(--line);
    font-size:11px;color:var(--muted);
    text-transform:uppercase;letter-spacing:.06em;
    padding:8px 10px;
  }
  tbody td{
    border-bottom:1px solid var(--line);
    padding:8px 10px;vertical-align:middle;font-size:13px;
  }
  .idx{width:40px;text-align:center;color:var(--muted);}
  .name input{
    width:100%;padding:7px 9px;
    border:1px solid var(--line);border-radius:10px;
    font-size:13px;background:#fff;
  }

  .rating{
    user-select:none;display:flex;gap:4px;align-items:center;min-height:32px;
  }
  .icon{
    width:24px;height:24px;
    display:inline-flex;align-items:center;justify-content:center;
    cursor:pointer;transition:transform .06s ease;
  }
  .icon svg{width:100%;height:100%;display:block;fill:var(--icon-off);filter:grayscale(1)}
  .icon.active svg{fill:var(--icon-on);filter:none}
  .icon:active{transform:scale(.96)}

  .score{width:90px;text-align:center;font-weight:700;font-size:13px;font-variant-numeric:tabular-nums}
  .muted{color:var(--muted);font-size:12px}

  .adjust{min-width:170px}
  .adjust-buttons{
    display:flex;flex-wrap:wrap;gap:4px;
  }
  .adjust-buttons button{
    padding:3px 7px;font-size:11px;
    border-radius:8px;
  }

  /* Percent mode */
  .percent-wrap{
    position:relative;
    flex:1;
    max-width:220px;
    height:12px;
    background:#e5e7eb;
    border-radius:999px;
    cursor:pointer;
  }
  .percent-fill{
    position:absolute;left:0;top:0;bottom:0;
    width:0;border-radius:999px;
    background:linear-gradient(90deg,var(--icon-on),var(--green));
  }
  .percent-label{
    min-width:56px;text-align:center;
    font-variant-numeric:tabular-nums;
    font-size:12px;
  }

  footer{
    text-align:center;
    font-size:12px;
    color:var(--muted);
    padding:12px 0 18px;
  }

  @media print{
    .header button,
    .teams-card,
    .adjust{display:none !important}
    body{background:#fff}
    .card{box-shadow:none;border:none}
    thead th{background:#fff}
    footer{display:none !important}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="header">
      <div>
        <div class="title">Class Assessment Dashboard</div>
        <div class="subtitle">Hand, Star, Smile, Medal, Percent + Bonus points + Teams + Export CSV</div>
      </div>

      <div>
        <div class="controls">
          <div class="modes">
            <button class="mode-btn" data-mode="hand"   aria-pressed="true">üñê Hand</button>
            <button class="mode-btn" data-mode="star"   aria-pressed="false">‚≠ê Star</button>
            <button class="mode-btn" data-mode="smile"  aria-pressed="false">üòä Smile</button>
            <button class="mode-btn" data-mode="medal"  aria-pressed="false">üèÖ Medal</button>
            <button class="mode-btn" data-mode="percent" aria-pressed="false">% Percent</button>
          </div>
        </div>
        <div class="controls">
          <button id="exportBtn">Export CSV</button>
          <button id="resetBtn" class="primary">Reset all</button>
        </div>
      </div>
    </div>

    <div class="layout">
      <!-- LEFT: TABLE -->
      <div class="table-wrapper">
        <table id="tbl">
          <thead>
            <tr>
              <th class="idx">#</th>
              <th>Student name</th>
              <th>Rating</th>
              <th>Score</th>
              <th>Adjust</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
          <tfoot>
            <tr>
              <td colspan="5" class="muted">
                Rating gives base points. Adjust buttons add or subtract bonus points.
              </td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- RIGHT: TEAMS -->
      <div class="side-panel">
        <div class="teams-card">
          <div class="teams-title">Team scores</div>
          <div class="teams">
            <div class="team" data-team="1">
              <div class="team-name">Team 1</div>
              <div class="team-score" id="team1Score">0</div>
              <div class="team-buttons">
                <button data-delta="1">+1</button>
                <button data-delta="5">+5</button>
                <button data-delta="-1">-1</button>
                <button data-delta="-5">-5</button>
                <button data-reset="1">‚ü≥</button>
              </div>
            </div>
            <div class="team" data-team="2">
              <div class="team-name">Team 2</div>
              <div class="team-score" id="team2Score">0</div>
              <div class="team-buttons">
                <button data-delta="1">+1</button>
                <button data-delta="5">+5</button>
                <button data-delta="-1">-1</button>
                <button data-delta="-5">-5</button>
                <button data-reset="1">‚ü≥</button>
              </div>
            </div>
            <div class="team" data-team="3">
              <div class="team-name">Team 3</div>
              <div class="team-score" id="team3Score">0</div>
              <div class="team-buttons">
                <button data-delta="1">+1</button>
                <button data-delta="5">+5</button>
                <button data-delta="-1">-1</button>
                <button data-delta="-5">-5</button>
                <button data-reset="1">‚ü≥</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<footer>
  Created by <strong>Nazerke Kairatkyzy</strong>
</footer>

<!-- ICON TEMPLATES BELOW -->
<template id="tpl-hand">
  <span class="icon" data-value="0">
    <svg viewBox="0 0 24 24"><path d="M2 21h3a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2H2v11ZM22 10a2 2 0 0 0-2-2h-6.31l.95-4.57a1.5 1.5 0 0 0-2.94-.63L10 8 7 8a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h9a2 2 0 0 0 1.94-1.5l1.2-5a2 2 0 0 0 1.86-1.99V10Z"/></svg>
  </span>
</template>

<template id="tpl-star">
  <span class="icon" data-value="0">
    <svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.3 6.95 1.01-5.02 4.89 1.19 6.93L12 18.77 5.79 21.13l1.19-6.93L1.96 9.31l6.95-1.01L12 2z"/></svg>
  </span>
</template>

<template id="tpl-smile">
  <span class="icon" data-value="0">
    <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm-3 7a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm6 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-6.5 6a5.5 5.5 0 0 0 9 0 .75.75 0 0 0-1.25-.85 4 4 0 0 1-6.5 0A.75.75 0 0 0 8.5 15Z"/></svg>
  </span>
</template>

<template id="tpl-medal">
  <span class="icon" data-value="0">
    <svg viewBox="0 0 24 24"><path d="M7 2h4l1 3 1-3h4l-3 7h-4L7 2Zm5 8a7 7 0 1 0 .001 14.001A7 7 0 0 0 12 10Zm0 3a4 4 0 1 1 0 8 4 4 0 0 1 0-8Z"/></svg>
  </span>
</template>

<script>
(function(){
  const tbody = document.getElementById('tbody');
  const modeButtons = document.querySelectorAll('.mode-btn');
  const exportBtn = document.getElementById('exportBtn');
  const resetBtn = document.getElementById('resetBtn');

  const tplHand  = document.getElementById('tpl-hand');
  const tplStar  = document.getElementById('tpl-star');
  const tplSmile = document.getElementById('tpl-smile');
  const tplMedal = document.getElementById('tpl-medal');

  let currentMode = 'hand';
  const ROW_COUNT = 25;
  const POINT_PER_LEVEL = 5;

  function createRow(index){
    const tr = document.createElement('tr');
    tr.dataset.level  = "0";
    tr.dataset.percent= "0";
    tr.dataset.bonus  = "0";

    const tdIdx = document.createElement('td');
    tdIdx.className = 'idx';
    tdIdx.textContent = index;
    tr.appendChild(tdIdx);

    const tdName = document.createElement('td');
    tdName.className = 'name';
    const inp = document.createElement('input');
    inp.type = 'text';
    inp.placeholder = 'Student name';
    tdName.appendChild(inp);
    tr.appendChild(tdName);

    const tdRating = document.createElement('td');
    tdRating.className = 'rating-cell';
    tr.appendChild(tdRating);

    const tdScore = document.createElement('td');
    tdScore.className = 'score';
    tdScore.textContent = '‚Äî';
    tr.appendChild(tdScore);

    const tdAdjust = document.createElement('td');
    tdAdjust.className = 'adjust';
    tr.appendChild(tdAdjust);

    tbody.appendChild(tr);

    renderRatingCell(tr);
    renderAdjustCell(tr);
    updateScoreDisplay(tr);
  }

  function baseScoreForRow(tr){
    const level   = parseInt(tr.dataset.level   || '0',10);
    const percent = parseInt(tr.dataset.percent || '0',10);
    if(currentMode === 'percent'){
      return percent;
    } else {
      return level * POINT_PER_LEVEL;
    }
  }

  function updateScoreDisplay(tr){
    const scoreEl = tr.querySelector('.score');
    const bonus = parseInt(tr.dataset.bonus || '0',10);
    const base  = baseScoreForRow(tr);
    const total = base + bonus;
    scoreEl.textContent = total !== 0 ? String(total) : '‚Äî';
  }

  function renderRatingCell(tr){
    const tdRating = tr.querySelector('.rating-cell');
    tdRating.innerHTML = '';

    const level   = parseInt(tr.dataset.level   || '0',10);
    const percent = parseInt(tr.dataset.percent || '0',10);

    if(currentMode === 'percent'){
      const wrap = document.createElement('div');
      wrap.className = 'rating';

      const bar = document.createElement('div');
      bar.className = 'percent-wrap';

      const fill = document.createElement('div');
      fill.className = 'percent-fill';
      fill.style.width = percent + '%';
      bar.appendChild(fill);

      const label = document.createElement('div');
      label.className = 'percent-label';
      label.textContent = percent + '%';

      function setPercentFromEvent(ev){
        const rect = bar.getBoundingClientRect();
        let x = ev.clientX - rect.left;
        x = Math.max(0, Math.min(rect.width, x));
        const p = Math.round(x / rect.width * 100);
        tr.dataset.percent = String(p);
        fill.style.width = p + '%';
        label.textContent = p + '%';
        updateScoreDisplay(tr);
      }

      bar.addEventListener('click', setPercentFromEvent);
      bar.addEventListener('mousemove', ev=>{
        if(ev.buttons === 1){ setPercentFromEvent(ev); }
      });

      wrap.appendChild(bar);
      wrap.appendChild(label);
      tdRating.appendChild(wrap);
      updateScoreDisplay(tr);
      return;
    }

    const rating = document.createElement('div');
    rating.className = 'rating';

    const tplMap = {hand:tplHand, star:tplStar, smile:tplSmile, medal:tplMedal};
    const tpl = tplMap[currentMode];

    for(let i=1;i<=5;i++){
      const icon = tpl.content.firstElementChild.cloneNode(true);
      if(i <= level) icon.classList.add('active');
      icon.dataset.value = i;
      icon.addEventListener('click',()=>{
        tr.dataset.level = String(i);
        updateIcons(rating,i);
        updateScoreDisplay(tr);
      });
      rating.appendChild(icon);
    }

    tdRating.appendChild(rating);
    updateScoreDisplay(tr);
  }

  function updateIcons(container, level){
    const icons = container.querySelectorAll('.icon');
    icons.forEach(icon=>{
      const v = parseInt(icon.dataset.value||'0',10);
      icon.classList.toggle('active', v <= level);
    });
  }

  function renderAdjustCell(tr){
    const tdAdjust = tr.querySelector('.adjust');
    tdAdjust.innerHTML = '';
    const wrap = document.createElement('div');
    wrap.className = 'adjust-buttons';

    const deltas = [1,2,5,-1,-2,-5];
    deltas.forEach(d=>{
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.textContent = (d>0?'+':'') + d;
      btn.addEventListener('click',()=>{
        const current = parseInt(tr.dataset.bonus||'0',10);
        tr.dataset.bonus = String(current + d);
        updateScoreDisplay(tr);
      });
      wrap.appendChild(btn);
    });

    tdAdjust.appendChild(wrap);
  }

  for(let i=1;i<=ROW_COUNT;i++){
    createRow(i);
  }

  modeButtons.forEach(btn=>{
    btn.addEventListener('click',()=>{
      const mode = btn.dataset.mode;
      if(mode===currentMode) return;
      currentMode = mode;

      modeButtons.forEach(b=>{
        b.setAttribute('aria-pressed', b===btn ? 'true':'false');
      });

      const rows = tbody.querySelectorAll('tr');
      rows.forEach(tr=>{
        renderRatingCell(tr);
        updateScoreDisplay(tr);
      });
    });
  });

  exportBtn.addEventListener('click',()=>{
    const rows = tbody.querySelectorAll('tr');
    const lines = [];

    lines.push(['#','Name','Level','Percent','Bonus','Total'].join(','));

    rows.forEach(tr=>{
      const idx = tr.children[0].textContent.trim();
      const name = tr.querySelector('input')?.value.replace(/"/g,'""') || '';
      const level = tr.dataset.level || '0';
      const percent = tr.dataset.percent || '0';
      const bonus = tr.dataset.bonus || '0';

      const base = currentMode==='percent'
        ? parseInt(percent,10)
        : parseInt(level,10) * POINT_PER_LEVEL;
      const total = base + parseInt(bonus,10);

      lines.push([
        idx,
        `"${name}"`,
        level,
        percent,
        bonus,
        String(total)
      ].join(','));
    });

    const blob = new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'assessment.csv';
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(url);
  });

  resetBtn.addEventListener('click',()=>{
    const rows = tbody.querySelectorAll('tr');
    rows.forEach(tr=>{
      tr.dataset.level="0";
      tr.dataset.percent="0";
      tr.dataset.bonus="0";
      tr.querySelector('input').value='';
      renderRatingCell(tr);
      renderAdjustCell(tr);
      updateScoreDisplay(tr);
    });

    document.getElementById('team1Score').textContent='0';
    document.getElementById('team2Score').textContent='0';
    document.getElementById('team3Score').textContent='0';
  });

  const teamScores={1:0,2:0,3:0};
  document.querySelectorAll('.team').forEach(team=>{
    const id=parseInt(team.dataset.team,10);
    const scoreEl=team.querySelector('.team-score');
    team.querySelectorAll('button').forEach(btn=>{
      const delta=btn.getAttribute('data-delta');
      const reset=btn.getAttribute('data-reset');

      if(delta){
        btn.addEventListener('click',()=>{
          teamScores[id]+=parseInt(delta,10);
          scoreEl.textContent=teamScores[id];
        });
      }
      if(reset){
        btn.addEventListener('click',()=>{
          teamScores[id]=0;
          scoreEl.textContent=0;
        });
      }
    });
  });

})();
</script>
</body>
</html>
