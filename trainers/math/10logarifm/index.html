<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LOGIC LAB PRO ‚Äî –õ–æ–≥–∞—Ä–∏—Ñ–º–¥—ñ–∫ —Ç–µ“£—Å—ñ–∑–¥—ñ–∫—Ç–µ—Ä (10 –µ—Å–µ–ø) ¬∑ –æ—Ñ–ª–∞–π–Ω</title>
  <style>
    :root{
      --bg:#f7f9ff;
      --card:#ffffff;
      --ink:#172048;
      --muted:#55618a;
      --line:rgba(23,32,72,.12);
      --shadow:0 16px 40px rgba(22,28,60,.10);
      --ok:#10b981;
      --bad:#ef476f;
      --warn:#f59e0b;
      --accent:#6366f1;
      --seg:#dbe3ff;
      --segOn:#a7f3d0;
      --segOn2:#fde68a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--ink);
      background:
        radial-gradient(900px 650px at 12% 10%, rgba(99,102,241,.18), transparent 60%),
        radial-gradient(900px 650px at 88% 14%, rgba(16,185,129,.14), transparent 60%),
        radial-gradient(900px 650px at 50% 92%, rgba(245,158,11,.12), transparent 60%),
        var(--bg);
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(247,249,255,.82);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px}
    .top{display:flex;gap:12px;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;padding:14px 0}
    h1{margin:0;font-size:18px}
    .sub{margin-top:6px;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1.25fr .75fr;gap:14px;padding:14px 0 28px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.92));
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow:var(--shadow);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    label{font-size:12px;color:var(--muted)}
    input, select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(23,32,72,.16);
      background:#fff;
      color:var(--ink);
      outline:none;
    }
    textarea{min-height:90px;resize:vertical}
    .btn{
      cursor:pointer; user-select:none;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(23,32,72,.14);
      background:linear-gradient(180deg,#fff,#eef2ff);
      color:var(--ink);
      transition:transform .12s ease, filter .12s ease;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.02)}
    .btn:active{transform:translateY(0);filter:brightness(.99)}
    .btn.ok{border-color:rgba(16,185,129,.40)}
    .btn.bad{border-color:rgba(239,71,111,.40)}
    .btn.warn{border-color:rgba(245,158,11,.45)}
    .pill{
      font-size:12px;
      border:1px solid rgba(23,32,72,.14);
      padding:6px 10px;
      border-radius:999px;
      color:var(--muted);
      background:#fff;
    }
    .pill.ok{border-color:rgba(16,185,129,.45); color:rgba(16,185,129,.95)}
    .pill.bad{border-color:rgba(239,71,111,.45); color:rgba(239,71,111,.95)}
    .sep{height:1px;background:var(--line);margin:12px 0}
    .muted{color:var(--muted);font-size:13px}
    .small{color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media(max-width:720px){.kpi{grid-template-columns:repeat(2,1fr)}}
    .kpi .box{border:1px solid var(--line);border-radius:14px;padding:10px;background:#fff}
    .kpi .n{font-weight:900;font-size:18px}
    .kpi .t{font-size:12px;color:var(--muted)}
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:#fff;border:1px solid var(--line);box-shadow:var(--shadow);
      padding:10px 12px;border-radius:999px;font-size:13px;display:none;z-index:99;
    }

    /* Number line */
    .nl{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:12px;
    }
    .cuts{
      display:grid;
      grid-auto-flow:column;
      grid-auto-columns:1fr;
      gap:8px;
      align-items:stretch;
    }
    .seg{
      position:relative;
      height:54px;
      border-radius:12px;
      background:linear-gradient(180deg, #ffffff, var(--seg));
      border:1px solid rgba(23,32,72,.12);
      cursor:pointer;
      overflow:hidden;
      display:flex;align-items:flex-end;justify-content:center;
      padding:6px;
      transition:transform .12s ease, filter .12s ease;
    }
    .seg:hover{transform:translateY(-1px);filter:brightness(1.01)}
    .seg.on{
      background:linear-gradient(180deg, #ffffff, var(--segOn));
      border-color:rgba(16,185,129,.45);
    }
    .seg.on.alt{
      background:linear-gradient(180deg, #ffffff, var(--segOn2));
      border-color:rgba(245,158,11,.45);
    }
    .seg .lab{font-size:11px;color:rgba(23,32,72,.78);text-align:center;line-height:1.05}
    .tickRow{
      display:flex;
      justify-content:space-between;
      gap:8px;
      margin-top:8px;
      flex-wrap:wrap;
    }
    .tick{
      display:flex;gap:8px;align-items:center;
      border:1px solid var(--line);
      border-radius:12px;
      padding:8px 10px;
      background:#fff;
      font-size:12px;
      color:var(--muted);
      min-width:140px;
    }
    .tick input{width:auto}
    details{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
    summary{cursor:pointer}

    .badge{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--line);border-radius:999px;
      padding:6px 10px;background:#fff;color:var(--muted);font-size:12px;
    }
    .dot{width:10px;height:10px;border-radius:999px;border:1px solid rgba(23,32,72,.22);display:inline-block}
  </style>
</head>
<body>
<header>
  <div class="wrap top">
    <div>
      <h1>LOGIC LAB PRO ‚Äî –õ–æ–≥–∞—Ä–∏—Ñ–º–¥—ñ–∫ —Ç–µ“£—Å—ñ–∑–¥—ñ–∫—Ç–µ—Ä (10 –µ—Å–µ–ø)</h1>
      <div class="sub">–ú“Ø–ª–¥–µ –±–∞—Å“õ–∞ —Å—Ç–∏–ª—å: –∏–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã ‚Äú“õ“±—Ä–∞—Å—Ç—ã—Ä—É‚Äù ¬∑ –û–î–ó/—à–µ–∫–∞—Ä–∞ –Ω“Ø–∫—Ç–µ–ª–µ—Ä—ñ ¬∑ “õ–∞—Ç–µ/–∫”©–º–µ–∫/—É–∞“õ—ã—Ç —Ç–∞–ª–¥–∞—É—ã ¬∑ –æ—Ñ–ª–∞–π–Ω 1 —Ñ–∞–π–ª</div>
    </div>
    <div class="row" style="align-items:center">
      <span class="badge"><span class="dot" style="background:rgba(16,185,129,.55)"></span>–î“±—Ä—ã—Å –∏–Ω—Ç–µ—Ä–≤–∞–ª</span>
      <span class="badge"><span class="dot" style="background:rgba(245,158,11,.55)"></span>2-–∏–Ω—Ç–µ—Ä–≤–∞–ª</span>
      <span class="badge"><span class="dot" style="background:rgba(239,71,111,.55)"></span>“ö–∞—Ç–µ/–û–î–ó</span>
    </div>
  </div>
</header>

<div class="toast" id="toast"></div>

<div class="wrap grid">
  <section class="card">
    <div class="row">
      <div style="flex:1;min-width:220px">
        <label>–û“õ—É—à—ã–Ω—ã“£ –∞—Ç—ã-–∂”©–Ω—ñ</label>
        <input id="studentName" placeholder="–ú—ã—Å–∞–ª—ã: –ê–π–∞—Ä—É" />
      </div>
      <div style="width:140px">
        <label>–°—ã–Ω—ã–ø</label>
        <input id="studentClass" placeholder="10A" />
      </div>
      <div style="width:260px">
        <label>–ï—Å–µ–ø</label>
        <select id="taskSelect"></select>
      </div>
      <div class="row">
        <span class="pill" id="timerPill">‚è± 00:00</span>
        <span class="pill" id="statusPill">”ò–ª—ñ —Ç–µ–∫—Å–µ—Ä—ñ–ª–º–µ–¥—ñ</span>
      </div>
    </div>

    <div class="sep"></div>

    <div class="mono" id="ineqText" style="font-size:18px;line-height:1.35;white-space:pre-wrap"></div>
    <div class="small" id="domainText" style="margin-top:10px"></div>

    <div class="sep"></div>

    <div class="nl">
      <b>–°–∞–Ω —Å”ô—É–ª–µ—Å—ñ ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã —Ç–∞“£–¥–∞</b>
      <div class="small" style="margin-top:6px">
        ”ò—Ä —Å–µ–≥–º–µ–Ω—Ç—Ç—ñ –±–∞—Å—ã–ø “õ–æ—Å/”©—à—ñ—Ä. –ï–≥–µ—Ä –∂–∞—É–∞–ø—Ç–∞ —à–µ–∫–∞—Ä–∞ –Ω“Ø–∫—Ç–µ—Å—ñ <b>–∫—ñ—Ä–µ–¥—ñ</b> (–∂–∞–±—ã“õ) –±–æ–ª—Å–∞ ‚Äî —Ç”©–º–µ–Ω–¥–µ–≥—ñ ‚Äú–ù“Ø–∫—Ç–µ–Ω—ñ “õ–æ—Å—É‚Äù –±–µ–ª–≥—ñ—Å—ñ–Ω “õ–æ–π.
      </div>

      <div class="sep"></div>

      <div id="segments" class="cuts"></div>

      <div class="sep"></div>

      <b class="small">–ù“Ø–∫—Ç–µ–Ω—ñ “õ–æ—Å—É (–∂–∞–±—ã“õ —à–µ–∫–∞—Ä–∞–ª–∞—Ä “Ø—à—ñ–Ω “ì–∞–Ω–∞):</b>
      <div id="pointToggles" class="tickRow"></div>

      <div class="sep"></div>

      <div class="row">
        <button class="btn ok" id="checkBtn">‚úî –¢–µ–∫—Å–µ—Ä—É</button>
        <button class="btn" id="clearBtn">‚Ü∫ –¢–∞“£–¥–∞—É–¥—ã —Ç–∞–∑–∞—Ä—Ç—É</button>
        <button class="btn" id="hint1Btn">üí° –ö”©–º–µ–∫ 1</button>
        <button class="btn" id="hint2Btn">üí° –ö”©–º–µ–∫ 2</button>
        <button class="btn bad" id="revealBtn">üëÅ –ñ–∞—É–∞–ø—Ç—ã –∫”©—Ä—Å–µ—Ç—É</button>
      </div>

      <details id="hintBox1" style="display:none;margin-top:10px">
        <summary>–ö”©–º–µ–∫ 1</summary>
        <div class="small" id="hint1Text"></div>
      </details>
      <details id="hintBox2" style="display:none;margin-top:10px">
        <summary>–ö”©–º–µ–∫ 2</summary>
        <div class="small" id="hint2Text"></div>
      </details>
      <details id="solBox" style="display:none;margin-top:10px">
        <summary>–î“±—Ä—ã—Å –∂–∞—É–∞–ø (–∫—ñ–ª—Ç)</summary>
        <div class="small mono" id="solText" style="white-space:pre-wrap"></div>
      </details>
    </div>

    <div class="sep"></div>
    <div class="small" id="taskMeta"></div>

    <div class="sep"></div>
    <div class="row" style="justify-content:space-between">
      <button class="btn" id="finishBtn">üìä –°–æ“£“ì—ã —Ç–∞–ª–¥–∞—É</button>
      <button class="btn" id="copyReportBtn">üßæ –ï—Å–µ–ø—Ç—ñ –∫”©—à—ñ—Ä—É</button>
      <button class="btn" id="resetAllBtn">üóë –ë–∞—Ä–ª—ã“ì—ã–Ω —Ç–∞–∑–∞—Ä—Ç—É</button>
    </div>
  </section>

  <aside class="card">
    <b>PRO-—Ç–∞–ª–¥–∞—É –ø–∞–Ω–µ–ª—ñ</b>
    <div class="sep"></div>

    <div class="kpi">
      <div class="box"><div class="n" id="kpiDone">0</div><div class="t">–î“±—Ä—ã—Å (–µ—Å–µ–ø —Å–∞–Ω—ã)</div></div>
      <div class="box"><div class="n" id="kpiWrong">0</div><div class="t">“ö–∞—Ç–µ ”ô—Ä–µ–∫–µ—Ç</div></div>
      <div class="box"><div class="n" id="kpiHints">0</div><div class="t">–ö”©–º–µ–∫ —Å–∞–Ω—ã</div></div>
      <div class="box"><div class="n" id="kpiTime">00:00</div><div class="t">–ñ–∞–ª–ø—ã —É–∞“õ—ã—Ç</div></div>
    </div>

    <div class="sep"></div>

    <b>“ö–∏—ã–Ω –±–æ–ª“ì–∞–Ω –µ—Å–µ–ø—Ç–µ—Ä</b>
    <div class="small" id="hotTasks" style="margin-top:8px"></div>

    <div class="sep"></div>

    <b>–ï—Ä–µ–∂–µ-—à–ø–∞—Ä–≥–∞–ª–∫–∞</b>
    <div class="small" style="margin-top:8px;line-height:1.45">
      ‚Ä¢ <b>–û–î–ó</b>: –∞—Ä–≥—É–º–µ–Ω—Ç &gt; 0, –Ω–µ–≥—ñ–∑ &gt; 0, –Ω–µ–≥—ñ–∑ ‚â† 1<br>
      ‚Ä¢ –ï–≥–µ—Ä <b>0&lt;a&lt;1</b>, –æ–Ω–¥–∞ –ª–æ–≥–∞—Ä–∏—Ñ–º <b>–∫–µ–º—ñ–º–µ–ª—ñ</b> ‚Üí —Ç–µ“£—Å—ñ–∑–¥—ñ–∫ –±–∞“ì—ã—Ç—ã –∞—É—ã—Å–∞–¥—ã<br>
      ‚Ä¢ –ò–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã “õ“±—Ä–∞—Å—Ç—ã—Ä—É: <b>—Å—ã–Ω–∏ –Ω“Ø–∫—Ç–µ–ª–µ—Ä</b> –∞—Ä“õ—ã–ª—ã –±”©–ª—ñ–ø —Ç–µ–∫—Å–µ—Ä
    </div>
  </aside>
</div>

<script>
/* =========================================================
   LOGIC LAB PRO ‚Äî 10 –µ—Å–µ–ø (–∫—ñ–ª—Ç—Ç–µ—Ä—ñ –µ—Å–µ–ø—Ç–µ–ª–≥–µ–Ω)
   –ò–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã —Å–µ–≥–º–µ–Ω—Ç –∞—Ä“õ—ã–ª—ã —Ç–∞“£–¥–∞—É + –∂–∞–±—ã“õ –Ω“Ø–∫—Ç–µ —Ç–æ–≥–≥–ª
   ========================================================= */

const $ = (id)=>document.getElementById(id);

function toast(msg){
  const el = $("toast");
  el.textContent = msg;
  el.style.display = "block";
  clearTimeout(toast._t);
  toast._t = setTimeout(()=> el.style.display="none", 2200);
}

function fmtTime(sec){
  const m = String(Math.floor(sec/60)).padStart(2,"0");
  const s = String(Math.floor(sec%60)).padStart(2,"0");
  return `${m}:${s}`;
}

/**
 * cuts: array of cut labels in order, including "-‚àû" and "+‚àû" if needed.
 * segments are between cuts[i]..cuts[i+1]
 *
 * answerSegments: array of segment indices that are ON
 * answerClosedPoints: array of cut labels that must be INCLUDED (closed boundary)
 *
 * NOTE: This PRO version uses symbolic labels where needed (‚àö2, ‚àö5, log3 10, 1-log2 3, T, ...).
 * Students don't type numbers; they build interval structure.
 */
const TASKS = [
  // 1
  {
    id: 1,
    ineq: "1)  log\u2092\u2093\u2093(x¬≤) < 1   (–Ω–µ–≥—ñ–∑: 2x+3)",
    domain: "–û–î–ó: x‚â†0, 2x+3>0 (x>-3/2), 2x+3‚â†1 (x‚â†-1)",
    hint1: "2x+3 > 1 –∂”ô–Ω–µ 0 < 2x+3 < 1 –∂–∞“ì–¥–∞–π–ª–∞—Ä—ã–Ω –±”©–ª–µ–∫ “õ–∞—Ä–∞—Å—Ç—ã—Ä.",
    hint2: "a>1 –±–æ–ª—Å–∞: log_a b < 1 ‚áî b < a.  0<a<1 –±–æ–ª—Å–∞: log_a b < 1 ‚áî b > a.",
    solText: "–ñ–∞—É–∞–ø: (-3/2, -1) ‚à™ (-1, 0) ‚à™ (0, 3)",
    cuts: ["-‚àû","-3/2","-1","0","3","+‚àû"],
    answerSegments: [1,2,3], // (-3/2,-1), (-1,0), (0,3)
    answerClosedPoints: []
  },
  // 2
  {
    id: 2,
    ineq: "2)  log\u2091\u2044\u2093( (5/2)x ‚àí 1 ) ‚â• ‚àí2   (–Ω–µ–≥—ñ–∑: 1/x)",
    domain: "–û–î–ó: x>0, x‚â†1, (5/2)x‚àí1>0 (x>2/5)",
    hint1: "0<x<1 –±–æ–ª—Å–∞ –Ω–µ–≥—ñ–∑>1, x>1 –±–æ–ª—Å–∞ –Ω–µ–≥—ñ–∑ 0<a<1.",
    hint2: "a>1: t ‚â• a^{-2}=x¬≤.  0<a<1: t ‚â§ x¬≤.",
    solText: "–ñ–∞—É–∞–ø: [1/2, 1) ‚à™ [2, +‚àû)",
    cuts: ["-‚àû","2/5","1/2","1","2","+‚àû"],
    answerSegments: [2,4], // [1/2,1) is segment 2..3, [2,‚àû) is segment 4..5
    answerClosedPoints: ["1/2","2"]
  },
  // 3
  {
    id: 3,
    ineq: "3)  log\u2093( log\u2089(3\u02e3 ‚àí 9) ) < 1",
    domain: "–û–î–ó: x>0, x‚â†1; 3^x‚àí9>0 (x>2); log‚Çâ(3^x‚àí9)>0 (3^x>10 ‚áí x>log‚ÇÉ10)",
    hint1: "–ê–ª–¥—ã–º–µ–Ω —ñ—à–∫—ñ –ª–æ–≥–∞—Ä–∏—Ñ–º–Ω—ñ“£ –û–î–ó-—ã–Ω —Ç–æ–ª—ã“õ –∂–∞–ø.",
    hint2: "x>1 –±–æ–ª“ì–∞–Ω–¥–∞ log_x(u)<1 ‚áî u<x. –ë“±–ª —Ç–µ“£—Å—ñ–∑–¥—ñ–∫ –¥–æ–º–µ–Ω–¥–µ –∞–≤—Ç–æ–º–∞—Ç –æ—Ä—ã–Ω–¥–∞–ª–∞–¥—ã.",
    solText: "–ñ–∞—É–∞–ø: (log‚ÇÉ10, +‚àû)",
    cuts: ["-‚àû","log‚ÇÉ10","+‚àû"],
    answerSegments: [1],
    answerClosedPoints: []
  },
  // 4
  {
    id: 4,
    ineq: "4)  log\u2080.\u2081(x¬≤ + x ‚àí 2) > log\u2080.\u2081(x + 3)",
    domain: "–û–î–ó: x+3>0 (x>-3); x¬≤+x‚àí2>0 ‚áí (x+2)(x‚àí1)>0 ‚áí x<-2 –Ω–µ–º–µ—Å–µ x>1",
    hint1: "–ù–µ–≥—ñ–∑ 0.1<1 ‚Üí –ª–æ–≥–∞—Ä–∏—Ñ–º –∫–µ–º—ñ–º–µ–ª—ñ ‚Üí —Ç–µ“£—Å—ñ–∑–¥—ñ–∫ –±–∞“ì—ã—Ç—ã –∞—É—ã—Å–∞–¥—ã.",
    hint2: "x¬≤+x‚àí2 < x+3 ‚áî x¬≤‚àí5<0 ‚áî ‚àí‚àö5 < x < ‚àö5.",
    solText: "–ñ–∞—É–∞–ø: (‚àí‚àö5, ‚àí2) ‚à™ (1, ‚àö5)",
    cuts: ["-‚àû","-3","-‚àö5","-2","1","‚àö5","+‚àû"],
    answerSegments: [2,4], // (-‚àö5,-2) is seg 2..3, (1,‚àö5) is seg 4..5
    answerClosedPoints: []
  },
  // 5
  {
    id: 5,
    ineq: "5)  ( log\u2082(3¬∑2\u02e3\u207b\u00b9 ‚àí 1) ) / x  ‚â• 1",
    domain: "–û–î–ó: x‚â†0; 3¬∑2^{x‚àí1}‚àí1>0 ‚áí x > 1‚àílog‚ÇÇ3",
    hint1: "x>0 –∂”ô–Ω–µ x<0 –∂–∞“ì–¥–∞–π–ª–∞—Ä—ã–Ω –±”©–ª–µ–∫ “õ–∞—Ä–∞—Å—Ç—ã—Ä (–±”©–ª—à–µ–∫!).",
    hint2: "2^x=t –∞—É—ã—Å—Ç—ã—Ä—É: log‚ÇÇ((3t‚àí2)/2)=log‚ÇÇ(3t‚àí2)‚àí1, x=log‚ÇÇt.",
    solText: "–ñ–∞—É–∞–ø: (1‚àílog‚ÇÇ3, 0) ‚à™ [1, +‚àû)",
    cuts: ["-‚àû","1‚àílog‚ÇÇ3","0","1","+‚àû"],
    answerSegments: [1,3], // (1-log‚ÇÇ3,0) is seg 1..2, [1,‚àû) is seg 3..4
    answerClosedPoints: ["1"]
  },
  // 6
  {
    id: 6,
    ineq: "6)  (x¬≤ ‚àí 4) / log\u2091\u2044\u2082(x¬≤ ‚àí 1) < 0",
    domain: "–û–î–ó: x¬≤‚àí1>0 ‚áí |x|>1; log_{1/2}(x¬≤‚àí1)‚â†0 ‚áí x¬≤‚â†2; —Å–æ–Ω–¥–∞–π-–∞“õ x‚â†¬±2 (“õ–∞—Ç–∞“£ <0)",
    hint1: "–ë”©–ª—à–µ–∫ <0 ‚áí –∞–ª—ã–º –º–µ–Ω –±”©–ª—ñ–º —Ç–∞“£–±–∞–ª–∞—Ä—ã “õ–∞—Ä–∞–º–∞-“õ–∞—Ä—Å—ã.",
    hint2: "log_{1/2}(u): u‚àà(0,1) –±–æ–ª—Å–∞ >0, u>1 –±–æ–ª—Å–∞ <0.",
    solText: "–ñ–∞—É–∞–ø: (‚àí‚àû, ‚àí2) ‚à™ (‚àí‚àö2, ‚àí1) ‚à™ (1, ‚àö2) ‚à™ (2, +‚àû)",
    cuts: ["-‚àû","-2","-‚àö2","-1","1","‚àö2","2","+‚àû"],
    answerSegments: [0,2,4,6], // (-‚àû,-2), (-‚àö2,-1), (1,‚àö2), (2,‚àû)
    answerClosedPoints: []
  },
  // 7
  {
    id: 7,
    ineq: "7)  log\u2091\u2044\u2082 x + log\u2083 x > 1",
    domain: "–û–î–ó: x>0",
    hint1: "log_{1/2}x = ‚àílog‚ÇÇx –µ–∫–µ–Ω—ñ–Ω –ø–∞–π–¥–∞–ª–∞–Ω.",
    hint2: "ln x ¬∑(1/ln3 ‚àí 1/ln2) > 1. –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–µ—Ä—ñ—Å ‚Üí —Ç–µ“£—Å—ñ–∑–¥—ñ–∫ –±–∞“ì—ã—Ç—ã –∞—É—ã—Å–∞–¥—ã.",
    solText: "–ñ–∞—É–∞–ø: (0, T), –º“±–Ω–¥–∞ T = 2^{‚àílog_{3/2}3} (—Ç“±—Ä–∞“õ—Ç—ã —Å–∞–Ω)",
    cuts: ["0","T","+‚àû"],
    answerSegments: [0], // (0,T)
    answerClosedPoints: []
  },
  // 8
  {
    id: 8,
    ineq: "8)  (1/2)^{log\u2082(x¬≤ ‚àí 1)} > 1",
    domain: "–û–î–ó: x¬≤‚àí1>0 ‚áí |x|>1",
    hint1: "(1/2)^{log‚ÇÇA} = 2^{‚àílog‚ÇÇA} = 1/A.",
    hint2: "1/(x¬≤‚àí1) > 1 ‚áí x¬≤ < 2 –∂”ô–Ω–µ |x|>1.",
    solText: "–ñ–∞—É–∞–ø: (‚àí‚àö2, ‚àí1) ‚à™ (1, ‚àö2)",
    cuts: ["-‚àû","-‚àö2","-1","1","‚àö2","+‚àû"],
    answerSegments: [1,3],
    answerClosedPoints: []
  },
  // 9
  {
    id: 9,
    ineq: "9)  log_{x+4}(5x+20) ‚â§ log_{x+4}(x+4)¬≤",
    domain: "–û–î–ó: x+4>0 (x>-4), x+4‚â†1 (x‚â†-3); 5x+20>0 (x>-4)",
    hint1: "a=x+4 –¥–µ–ø –∞–ª: log_a(5a) ‚â§ log_a(a¬≤).",
    hint2: "a>1 –±–æ–ª—Å–∞ (x>-3): 5a ‚â§ a¬≤ ‚áí a‚â•5 ‚áí x‚â•1.  0<a<1 –±–æ–ª—Å–∞ (‚àí4<x<‚àí3): —Ç–µ“£—Å—ñ–∑–¥—ñ–∫ –∫–µ—Ä—ñ –∂”ô–Ω–µ –∞–≤—Ç–æ–º–∞—Ç –æ—Ä—ã–Ω–¥–∞–ª–∞–¥—ã.",
    solText: "–ñ–∞—É–∞–ø: (‚àí4, ‚àí3) ‚à™ [1, +‚àû)",
    cuts: ["-‚àû","-4","-3","1","+‚àû"],
    answerSegments: [1,3],
    answerClosedPoints: ["1"]
  },
  // 10
  {
    id: 10,
    ineq: "10)  log_{x/6}( log\u2093( ‚àö(6‚àíx) ) ) > 0",
    domain: "–û–î–ó: 0<x<6, x‚â†1; ‚àö(6‚àíx)>0; —ñ—à–∫—ñ log_x(‚àö(6‚àíx))>0; —Å—ã—Ä—Ç“õ—ã –Ω–µ–≥—ñ–∑ x/6‚àà(0,1)",
    hint1: "x/6‚àà(0,1) –±–æ–ª“ì–∞–Ω–¥—ã“õ—Ç–∞–Ω log_{x/6}(b)>0 ‚áî 0<b<1.",
    hint2: "x>1 –∞–π–º–∞“ì—ã–Ω “õ–∞—Ä–∞: b=log_x(y).  b>0 ‚áí y>1, b<1 ‚áí y<x.  y=‚àö(6‚àíx).",
    solText: "–ñ–∞—É–∞–ø: (2, 5)",
    cuts: ["0","1","2","5","6"],
    answerSegments: [2], // (2,5)
    answerClosedPoints: []
  },
];

/* =========================================================
   State / analytics
   ========================================================= */
const state = {
  current: 0,
  per: TASKS.map(()=>({
    startedAt:null,
    elapsed:0,
    attempts:0,
    wrong:0,
    correct:0,
    hints:0,
    usedHint1:false,
    usedHint2:false,
    revealed:false,
    // selections
    selectedSegs: new Set(),
    selectedPoints: new Set(),
    lastCheck:null,
  }))
};

let timer=null;

function startTimer(){
  stopTimer();
  timer=setInterval(()=>{
    const t=state.per[state.current];
    if(!t.startedAt) t.startedAt=Date.now();
    t.elapsed = Math.floor((Date.now()-t.startedAt)/1000);
    $("timerPill").textContent = `‚è± ${fmtTime(t.elapsed)}`;
    renderMeta();
    renderKPIs();
  }, 250);
}
function stopTimer(){ if(timer) clearInterval(timer); timer=null; }

function setStatus(kind, text){
  const el=$("statusPill");
  if(kind==="ok"){ el.className="pill ok"; el.textContent=text; }
  else if(kind==="bad"){ el.className="pill bad"; el.textContent=text; }
  else { el.className="pill"; el.textContent=text; }
}

/* =========================================================
   UI render
   ========================================================= */
function initSelect(){
  const sel=$("taskSelect");
  sel.innerHTML="";
  TASKS.forEach((t,i)=>{
    const o=document.createElement("option");
    o.value=String(i);
    o.textContent = `${t.id}) –ï—Å–µ–ø ${t.id}`;
    sel.appendChild(o);
  });
}

function segLabel(a,b){
  // show open by default; closed handled via point toggles
  return `(${a}, ${b})`;
}

function renderTask(){
  const idx=state.current;
  const task=TASKS[idx];
  const st=state.per[idx];

  $("ineqText").textContent = task.ineq;
  $("domainText").innerHTML = `<b>–û–î–ó:</b> ${task.domain}`;

  // reset hint boxes visibility (keep used flags)
  $("hintBox1").style.display = st.usedHint1 ? "block" : "none";
  $("hintBox2").style.display = st.usedHint2 ? "block" : "none";
  $("solBox").style.display  = st.revealed ? "block" : "none";

  $("hint1Text").textContent = task.hint1;
  $("hint2Text").textContent = task.hint2;
  $("solText").textContent = task.solText;

  // segments
  const segWrap=$("segments");
  segWrap.innerHTML="";
  const cuts = task.cuts;
  const segCount = cuts.length - 1;

  for(let i=0;i<segCount;i++){
    const a=cuts[i], b=cuts[i+1];
    const div=document.createElement("div");
    div.className="seg";
    if(st.selectedSegs.has(i)){
      div.classList.add("on");
      // alternate highlight for variety if multiple segments
      if([...st.selectedSegs].indexOf(i)%2===1) div.classList.add("alt");
    }
    div.dataset.seg = String(i);
    div.innerHTML = `<div class="lab">${segLabel(a,b)}</div>`;
    div.addEventListener("click", ()=>{
      // toggle
      st.attempts++; // selection counts as an action in PRO
      if(st.selectedSegs.has(i)) st.selectedSegs.delete(i);
      else st.selectedSegs.add(i);
      toast("–ò–Ω—Ç–µ—Ä–≤–∞–ª ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ");
      renderTask();
      renderMeta();
      renderKPIs();
      // Do not mark wrong on selection; wrong only on check.
    });
    segWrap.appendChild(div);
  }

  // point toggles (only finite internal points, not -‚àû/+‚àû; also not domain-forbidden unless student wants)
  const ptsWrap=$("pointToggles");
  ptsWrap.innerHTML="";
  const points = cuts.filter(x=>x!=="-‚àû" && x!=="+‚àû");

  if(points.length===0){
    ptsWrap.innerHTML = `<div class="small">–ë“±–ª –µ—Å–µ–ø—Ç–µ –∂–∞–±—ã“õ –Ω“Ø–∫—Ç–µ –∂–æ“õ.</div>`;
  } else {
    points.forEach(p=>{
      const box=document.createElement("div");
      box.className="tick";
      const id="pt_"+idx+"_"+String(p).replaceAll(" ","").replaceAll("‚àí","-").replaceAll("/","_").replaceAll("‚àö","sqrt");
      const checked = st.selectedPoints.has(p);
      box.innerHTML = `
        <label style="display:flex;gap:10px;align-items:center;cursor:pointer;margin:0">
          <input type="checkbox" ${checked?"checked":""} id="${id}">
          <span>–ù“Ø–∫—Ç–µ –∫—ñ—Ä–µ–¥—ñ: <b class="mono">${p}</b></span>
        </label>`;
      box.querySelector("input").addEventListener("change",(e)=>{
        st.attempts++;
        if(e.target.checked) st.selectedPoints.add(p);
        else st.selectedPoints.delete(p);
        toast("–ù“Ø–∫—Ç–µ –±–µ–ª–≥—ñ—Å—ñ ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ");
        renderMeta(); renderKPIs();
      });
      ptsWrap.appendChild(box);
    });
  }

  // status
  if(st.lastCheck===null) setStatus("idle","”ò–ª—ñ —Ç–µ–∫—Å–µ—Ä—ñ–ª–º–µ–¥—ñ");
  else if(st.lastCheck===true) setStatus("ok","‚úî –î“±—Ä—ã—Å");
  else setStatus("bad","‚úñ “ö–∞—Ç–µ");

  startTimer();
  renderMeta();
  renderKPIs();
}

function renderMeta(){
  const st=state.per[state.current];
  $("taskMeta").innerHTML =
    `”ò—Ä–µ–∫–µ—Ç: <b>${st.attempts}</b> ¬∑ “ö–∞—Ç–µ: <b>${st.wrong}</b> ¬∑ –ö”©–º–µ–∫: <b>${st.hints}</b> ¬∑ –®–µ—à—ñ–º –∞—à—ã–ª–¥—ã: <b>${st.revealed?"–ò”ô":"–ñ–æ“õ"}</b>`;
}

function renderKPIs(){
  let done=0, wrong=0, hints=0, total=0;
  state.per.forEach(s=>{
    done += (s.correct>0)?1:0;
    wrong += s.wrong;
    hints += s.hints;
    total += s.elapsed||0;
  });
  $("kpiDone").textContent = done;
  $("kpiWrong").textContent = wrong;
  $("kpiHints").textContent = hints;
  $("kpiTime").textContent = fmtTime(total);

  // hot tasks
  const hot = state.per
    .map((s,i)=>({i, score: s.wrong + (s.revealed?1:0) + (s.hints*0.5)}))
    .sort((a,b)=>b.score-a.score)
    .slice(0,4)
    .filter(x=>x.score>0);

  $("hotTasks").innerHTML = hot.length
    ? hot.map(h=>`–ï—Å–µ–ø ${h.i+1}: “õ–∏—ã–Ω–¥—ã“õ –∏–Ω–¥–µ–∫—Å—ñ <b>${h.score.toFixed(1)}</b>`).join("<br>")
    : "”ò–∑—ñ—Ä—à–µ “õ–∏—ã–Ω –µ—Å–µ–ø –±–∞–π“õ–∞–ª–º–∞–¥—ã.";
}

/* =========================================================
   Check logic
   ========================================================= */
function setEquals(aSet, bArr){
  if(aSet.size !== bArr.length) return false;
  for(const v of bArr) if(!aSet.has(v)) return false;
  return true;
}
function setEqualsStr(aSet, bArr){
  if(aSet.size !== bArr.length) return false;
  for(const v of bArr) if(!aSet.has(v)) return false;
  return true;
}

function checkCurrent(){
  const idx=state.current;
  const task=TASKS[idx];
  const st=state.per[idx];

  // attempts counted when pressing check too
  st.attempts++;

  const segsOK = setEquals(st.selectedSegs, task.answerSegments);
  const ptsOK  = setEqualsStr(st.selectedPoints, task.answerClosedPoints);

  const ok = segsOK && ptsOK;

  st.lastCheck = ok;

  if(ok){
    st.correct = 1;
    toast("–î“±—Ä—ã—Å ‚úÖ");
  } else {
    st.wrong++;
    toast("“ö–∞—Ç–µ ‚ùå");
  }
  renderTask();
}

function clearSelection(){
  const st=state.per[state.current];
  st.selectedSegs.clear();
  st.selectedPoints.clear();
  st.lastCheck=null;
  toast("–¢–∞“£–¥–∞—É —Ç–∞–∑–∞—Ä—Ç—ã–ª–¥—ã");
  renderTask();
}

function showHint(which){
  const idx=state.current;
  const task=TASKS[idx];
  const st=state.per[idx];

  st.hints++;
  if(which===1){
    st.usedHint1=true;
    $("hintBox1").style.display="block";
    $("hintBox1").open=true;
    $("hint1Text").textContent=task.hint1;
    toast("–ö”©–º–µ–∫ 1 –∞—à—ã–ª–¥—ã");
  } else {
    st.usedHint2=true;
    $("hintBox2").style.display="block";
    $("hintBox2").open=true;
    $("hint2Text").textContent=task.hint2;
    toast("–ö”©–º–µ–∫ 2 –∞—à—ã–ª–¥—ã");
  }
  renderMeta();
  renderKPIs();
}

function reveal(){
  const st=state.per[state.current];
  st.revealed=true;
  $("solBox").style.display="block";
  $("solBox").open=true;
  toast("–ñ–∞—É–∞–ø –∫”©—Ä—Å–µ—Ç—ñ–ª–¥—ñ");
  renderMeta();
  renderKPIs();
}

/* =========================================================
   Report
   ========================================================= */
function buildReport(){
  const name=$("studentName").value.trim()||"–ê—Ç—ã –∂–æ“õ";
  const cls=$("studentClass").value.trim()||"‚Äî";
  let done=0, wrong=0, hints=0, total=0;

  const lines=[];
  lines.push("LOGIC LAB PRO ‚Äî –ï—Å–µ–ø –±–µ—Ä—É (–ª–æ–≥–∞—Ä–∏—Ñ–º–¥—ñ–∫ —Ç–µ“£—Å—ñ–∑–¥—ñ–∫—Ç–µ—Ä)");
  lines.push(`–û“õ—É—à—ã: ${name} | –°—ã–Ω—ã–ø: ${cls}`);
  lines.push("");

  state.per.forEach((s,i)=>{
    done += (s.correct>0)?1:0;
    wrong += s.wrong;
    hints += s.hints;
    total += s.elapsed||0;
    lines.push(`–ï—Å–µ–ø ${i+1}: ${s.correct>0?"‚úî –î“±—Ä—ã—Å":"‚Äî"} | ”ô—Ä–µ–∫–µ—Ç=${s.attempts} | “õ–∞—Ç–µ=${s.wrong} | –∫”©–º–µ–∫=${s.hints} | —à–µ—à—ñ–º=${s.revealed?"–∞—à—Ç—ã":"–∞—à–ø–∞–¥—ã"} | —É–∞“õ—ã—Ç=${fmtTime(s.elapsed)}`);
  });

  lines.push("");
  lines.push(`“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã: –¥“±—Ä—ã—Å=${done}/10 | “õ–∞—Ç–µ ”ô—Ä–µ–∫–µ—Ç=${wrong} | –∫”©–º–µ–∫=${hints} | –∂–∞–ª–ø—ã —É–∞“õ—ã—Ç=${fmtTime(total)}`);

  // heuristic feedback
  const hard = state.per
    .map((s,i)=>({i, score:s.wrong + (s.revealed?1:0) + (s.hints*0.5)}))
    .sort((a,b)=>b.score-a.score)
    .slice(0,3);

  lines.push(`“ö–∏—ã–Ω –±–æ–ª“ì–∞–Ω –µ—Å–µ–ø—Ç–µ—Ä: ${hard.map(x=>x.i+1).join(", ")}`);
  lines.push("“∞—Å—ã–Ω—ã—Å: –û–î–ó-–¥—ã —Ç–æ–ª—ã“õ –∂–∞–±—É (–Ω–µ–≥—ñ–∑>0, –Ω–µ–≥—ñ–∑‚â†1, –∞—Ä–≥—É–º–µ–Ω—Ç>0), 0<a<1 –±–æ–ª—Å–∞ —Ç–µ“£—Å—ñ–∑–¥—ñ–∫ –±–∞“ì—ã—Ç—ã –∞—É—ã—Å–∞—Ç—ã–Ω—ã–Ω “±–º—ã—Ç–ø–∞—É, —Å—ã–Ω–∏ –Ω“Ø–∫—Ç–µ–ª–µ—Ä –∞—Ä“õ—ã–ª—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã“õ —Ç–∞–ª–¥–∞—É.");
  return lines.join("\n");
}

/* =========================================================
   Wiring
   ========================================================= */
(function init(){
  initSelect();

  $("taskSelect").addEventListener("change", ()=>{
    state.current = Number($("taskSelect").value);
    renderTask();
  });

  $("checkBtn").addEventListener("click", checkCurrent);
  $("clearBtn").addEventListener("click", clearSelection);
  $("hint1Btn").addEventListener("click", ()=>showHint(1));
  $("hint2Btn").addEventListener("click", ()=>showHint(2));
  $("revealBtn").addEventListener("click", reveal);

  $("finishBtn").addEventListener("click", ()=>{
    stopTimer();
    alert(buildReport());
    startTimer();
  });

  $("copyReportBtn").addEventListener("click", async ()=>{
    const rep=buildReport();
    try{
      await navigator.clipboard.writeText(rep);
      toast("–ï—Å–µ–ø –±–µ—Ä—É –∫”©—à—ñ—Ä—ñ–ª–¥—ñ");
    }catch(e){
      const ta=document.createElement("textarea");
      ta.value=rep; document.body.appendChild(ta);
      ta.select(); document.execCommand("copy");
      document.body.removeChild(ta);
      toast("–ï—Å–µ–ø –±–µ—Ä—É –∫”©—à—ñ—Ä—ñ–ª–¥—ñ");
    }
  });

  $("resetAllBtn").addEventListener("click", ()=>{
    if(!confirm("–ë–∞—Ä–ª—ã“ì—ã–Ω —Ç–∞–∑–∞—Ä—Ç–∞—Å—ã“£ –±–∞?")) return;
    state.per = TASKS.map(()=>({
      startedAt:null, elapsed:0,
      attempts:0, wrong:0, correct:0, hints:0,
      usedHint1:false, usedHint2:false, revealed:false,
      selectedSegs:new Set(), selectedPoints:new Set(),
      lastCheck:null
    }));
    state.current=0;
    $("taskSelect").value="0";
    toast("–ë–∞—Ä–ª—ã“ì—ã —Ç–∞–∑–∞—Ä—Ç—ã–ª–¥—ã");
    renderTask();
  });

  // first render
  $("taskSelect").value="0";
  renderTask();
})();
</script>
</body>
</html>
